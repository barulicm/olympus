<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/Scorecard.css" media="screen" />
    <title>BEST Crossfire Scorecard</title>
</head>
<body>
<div class="navigation">
    <a class="navigation" href="index.html">Home</a>
</div>
<img id="logo" src="images/GameLogo.png"/>

<div class="scoreform">
    <form oninput="scoreOutput.value=calculateScore(parseInt(flames.value),parseInt(drums.value),rescue.checked,parseInt(rescueBonus.value))"
          onsubmit="submitScore(team.value,calculateScore(parseInt(flames.value),parseInt(drums.value),rescue.checked,parseInt(rescueBonus.value)))">
        <br/>
        <label for="team">Team</label>
        <input id="team" name="team" list="teams">
        <datalist id="teams">
            <option value="0000 - Team 1">
            <option value="97 - Fernbank LINKS">
        </datalist>
        <br><br>
        <label for="flames">Flames</label>
        <input type="number" id="flames" name="flames" value="0" max="30" min="0">
        <br><br>
        <label for="drums">Chemical Drums</label>
        <input type="number" id="drums" name="drums" value="0" max="3" min="0">
        <br><br>
        <label>Manikin</label>
        <br>
        <label for="rescue">Rescued</label>
        <input type="checkbox" id="rescue" name="rescue" onchange="scoreOutput.value=calculateScore(parseInt(flames.value),parseInt(drums.value),rescue.checked,parseInt(rescueBonus.value))">
        <br>
        <label for="rescueBonus">Bonus</label>
        <input type="number" id="rescueBonus" name="rescueBonus" value="0" max="180" min="0">
        <br><br>
        <output id="scoreOutput" name="scoreOutput" for="flames drums rescue rescueBonus"></output>
        <br>
        <input type="submit">
    </form>
</div>

<script>
    function calculateScore(flames,drums,rescue,rescueBonus) {
        var score = 0;
        score += flames * 5;
        if(flames === 30) {
            // "Under Control" Bonus
            score += 30;
        }
        score += drums * 40;
        if(rescue) {
            score += 120;
            score += rescueBonus;
        }
        return score;
    }

    function submitScore(team,score) {
        var jsonData = {};
        var endOfTeamNumber = team.indexOf(" ");
        jsonData.teamNumber = team.substring(0,endOfTeamNumber);
        alert(jsonData.teamNumber);
        jsonData.score = score;

        var xhr = new XMLHttpRequest();
        xhr.open('PUT', 'scores/submit', true);
        xhr.send(JSON.stringify(jsonData));
        xhr.onreadystatechange = ()=>{
            if(xhr.readyState === 4) {
                if(xhr.status === 200) {
                    location.reload();
                } else {
                    alert("Adding team failed. Status: " + xhr.status);
                }
            }
        }
    }
</script>
</body>
</html>